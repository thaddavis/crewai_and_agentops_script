# CrewAI + AgentOps Integration video

In this video we'll introduce 2 new tools coming out of the Agent development world

The 1st is CrewAI and the 2nd is AgentOps

CrewAI is a Multi-Agent framework and AgentOps is an Agent Observability tool

CrewAI is one of the leaders in their space as is AgentOps...

For reference, here's a list showing the leading open source multi-agent frameworks ordered by GitHub stars

1. LangChain/LangGraph - 92.7k/5.8k stars - 81 contributors - 41.9k in Discord - https://github.com/langchain-ai/langgraph
2. MetaGPT - 43.7k stars - 97 contributors - 5.1k in Discord - https://github.com/geekan/MetaGPT
3. AutoGen - 31.1k stars - 346 contributors - 19.7k in Discord - https://github.com/microsoft/autogen
4. Flowise - 30.1k stars - 139 contributors - 1.2k in Discord - https://github.com/FlowiseAI/Flowise
5. LangFlow - 29.5k stars - 162 contributors - 7.9k in Discord - https://github.com/langflow-ai/langflow
6. CrewAI - 19.5k stars - 142 contributors - 7.6k on X.com - https://github.com/crewAIInc/crewAI
7. Superagent - 5.1k stars - 66 contributors - 202 on Discord - https://github.com/superagent-ai/superagent
8. Agent Zero - 4.3k stars - 6 contributors - 1,316 on Discord - https://github.com/frdel/agent-zero
9. Agency Swarm - 2.4k stars - 10 contributors - 329 on Discord - https://github.com/VRSEN/agency-swarm
10. ell - 3.7k stars - 19 contributors - 456 on Discord - https://github.com/MadcowD/ell

HONORABLE MENTION

PraisonAI - https://github.com/MervinPraison/PraisonAI

And just so we get an overall view of the multi-agent landscape, let's rerank by social media reach...

1. LangChain/LangGraph - 92.7k/5.8k stars - 81 contributors - 41.9k in Discord - https://github.com/langchain-ai/langgraph
2. AutoGen - 31.1k stars - 346 contributors - 19.7k in Discord - https://github.com/microsoft/autogen
3. LangFlow - 29.5k stars - 162 contributors - 7.9k in Discord - https://github.com/langflow-ai/langflow
4. CrewAI - 19.5k stars - 142 contributors - 7.6k on X.com - https://github.com/crewAIInc/crewAI
5. MetaGPT - 43.7k stars - 97 contributors - 5.1k in Discord - https://github.com/geekan/MetaGPT
6. Agent Zero - 4.3k stars - 6 contributors - 1.3k on Discord - https://github.com/frdel/agent-zero
7. Flowise - 30.1k stars - 139 contributors - 1.2k in Discord - https://github.com/FlowiseAI/Flowise
8. ell - 3.7k stars - 19 contributors - 456 on Discord - https://github.com/MadcowD/ell
9. Agency Swarm - 2.4k stars - 10 contributors - 329 on Discord - https://github.com/VRSEN/agency-swarm
10. Superagent - 5.1k stars - 66 contributors - 202 on Discord - https://github.com/superagent-ai/superagent

https://www.linkedin.com/posts/adamsil_here-is-everything-that-you-need-to-know-activity-7241894867885293569-uvBt?utm_source=share&utm_medium=member_desktop

And here's a list showing the leading open source Agent Observability tools ordered by GitHub stars

1. LangFuse - 5.7k - 54 contributors - 1.7k in Discord - https://github.com/langfuse/langfuse
2. AgentOps - 1.7k stars - 19 contributors - 2.3k in Discord - https://github.com/AgentOps-AI/agentops
3. LangSmith - 379 stars - 36 contributors - 41.9k in Discord - https://github.com/langchain-ai/langsmith-sdk

AND let's rerank by social media reach to get an overall view again...

1. LangSmith - 379 stars - 36 contributors - 41.9k in Discord - https://github.com/langchain-ai/langsmith-sdk
2. AgentOps - 1.7k stars - 19 contributors - 2.3k in Discord - https://github.com/AgentOps-AI/agentops
3. LangFuse - 5.7k - 54 contributors - 1.7k in Discord - https://github.com/langfuse/langfuse

If there are companies you would have liked to see on these lists that were left out please leave a comment...

We will now show how YOU can use CrewAI w/ AgentOps FROM SCRATCH

- We will start with an empty project
- Then we'll create a Devcontainer so all our work is done inside of Docker
  - Using a Devcontainer will allow you to easily replicate exactly what you see in this video
  - AKA ->IF<- you want to code along, all you'll need to do is install VSCode & Docker on your machine
  - If you DON'T want to code along you will still learn how CrewAI and AgentOps works if you pay attention closely...
- After we have our Devcontainer set up, we will then build a super simple CrewAI project using 2 different approaches...
  - 1) First, we will build a CrewAI project manually
  - 2) and then Second, we will do so using the CrewAI CLI

- And after we build our CrewAI projects, we will then layer on AgentOps (in less than 30 seconds - it's super easy)
  - Adding AgentOps will give us useful insights into how the agents in our "Crew" work

- And then finally, we'll go Super Saiyan and DEMO how YOU can customize a CrewAI project for your own purposes
- In the DEMO, we'll make our agents resemble an acclaimed songwriting team that will be tasked with writing a #1 hit and we'll actually produce the song to see what it sounds like

Silence is golden...

--- --- --- --- ---

Here we go from scratch (aka an empty folder)...

## SHOW THE BOILERPLATE DIAGRAM

This is the 1st set of files that we will add...

project_root/
├── .devcontainer/
│   └── devcontainer.json
└── Dockerfile.dev

mkdir .devcontainer
touch .devcontainer/devcontainer.json
touch Dockerfile.dev

These files are compatible with Docker...

## Populate `devcontainer.json`

```devcontainer.json
{
  "name": "CrewAI + AgentOps",
  "build": {
    "dockerfile": "../Dockerfile.dev"
  },
  "customizations": {
    "vscode": {
        "extensions": [
            "ms-python.python",
            "ms-python.vscode-pylance",
            "ms-python.black-formatter",
            "ms-python.debugpy",
            "ms-azuretools.vscode-docker",
            "shd101wyy.markdown-preview-enhanced"
        ],
        "settings": {}
    }
  },
  "forwardPorts": [],
  "workspaceMount": "source=${localWorkspaceFolder},target=/code,type=bind,consistency=delegated",
  "workspaceFolder": "/code",
  "runArgs": []
}
```

## Populate `Dockerfile.dev`

```.Dockerfile.dev
FROM python:3.12-slim
RUN apt-get update && apt-get install -y build-essential
WORKDIR /code # set the working directory
ENV PYTHONPATH=/code
```

## Build the Devcontainer

Alrighty, now that we have these files added we can launch our Devcontainer like so...

SHIFT + COMMAND + P -> `Dev Containers: Reopen in Container`

To gloss over the details, we are now in another computer running on our computer. Inception type ish. We can play around with CrewAI in this machine, close it when we're done, and then our base machine will be clean as if nothing ever happened.

Let me know in the comments if you like this approach. I find it helps me stay organized.

Let's run a quick test and make sure we are looking good.

```.py
python --version
touch main.py
echo "print('Hello World')" > main.py
python main.py
```

√

```.py
rm main.py
```

```.py
pwd
```

## Now let's create a simple CrewAI app

We are going to create a simple CrewAI app in 2 ways

FIRST! Manually
SECOND! Using CrewAI's CLI

Let's start with the manual approach, which is NOT the recommended way to do things, but walking through this is great for learning how CrewAI works...

Here on CrewAI's documentation they provide an outline of what a CrewAI application looks like so let's take a look at the general outline...

https://docs.crewai.com/getting-started/Start-a-New-CrewAI-Project-Template-Method/#creating-a-new-project

In the same way a chef can look at a recipe and get the gist of it and then improvise on it when cooking a dish,
we are going to look at the general layout of a CrewAI project and riff on it...

# FIRST APPROACH

https://docs.crewai.com/getting-started/Start-a-New-CrewAI-Project-Template-Method/#creating-a-new-project

First, let's create the following files & folders...

```
mkdir -p src/crew_of_agents
touch src/crew_of_agents/main.py 
```

<!--
Often when looking at a coding project, you'll see a file called something along the lines of "main"

In this walkthrough, `main.py` will be the file we run to launch our project which will contain code (or instructions) for running a group of Agents...

Keep in mind, that we can call files, folders, and code snippets whatever we like when coding for example `blah.py`

<mini blah.py DEMO>

Names are just labels BUT! JUST SO it's easy for others to understand, collaborate, and build on top of our code, we follow conventions and these conventions you learn over time by working with others...
-->

```inside src/crew_of_agents/main.py let's place the following code
print("Run a crew of agents...")
```

TEST: `python src/crew_of_agents/main.py` √

OK! Now instead of simply printing a line that says "Run a crew of agents...", let's do something more interesting...

Let's import some of the official code provided by CrewAI and call it from our `main.py` script...

We building an application we could include all the related code in one file BUT that gets hectic as you are constantly scrolling looking for things when ready it...

THEREFORE, so our main file doesn't get bloated with too many lines let's create another file...

```
touch src/crew_of_agents/crew.py
```

Now let's add the following code that I pieced together by looking at various examples provided by CrewAI...

https://github.com/crewAIInc/crewAI-examples/blob/main/marketing_strategy/src/marketing_posts/crew.py

```add to src/crew_of_agents/crew.py
from crewai import Crew, Process
from crewai.project import CrewBase, agent, crew

@CrewBase
class CrewOfAgents():
	@agent
	def george_washington(self):
		return Agent()
	@agent
	def thomas_jefferson(self):
		return Agent()
	@crew
	def crew(self) -> Crew:
		return Crew(
			agents=self.agents,
			tasks=[],
			process=Process.sequential,
			verbose=True,
		)
```

```update src/crew_of_agents/main.py
from src.crew_of_agents.crew import CrewOfAgents

print("Calling the CrewOfAgents...")
CrewOfAgents().crew().kickoff()
```

## Try running our crew

- `python src/crew_of_agents/main.py`

Whengh, Whengh, Wheowgh...

## Importing `crewai`

We imported `crew.py` from `main.py` and that worked because the `ENV PYTHONPATH=/code` instruction told Python the base point of where to look...

But inside of this file we imported `crewai` from `crew.py`

The same way that we jumped from the main.py file over to the crew.py file, when our program gets to this point we now need to jump from the crew.py over to the code in some file provided to us by `crewai`

BUT `crewai` was nowhere to be found on our machine

So now we have to install it by typing...

- `pip install crewai==0.63.6`

## Let's run our crew again...

- `python src/crew_of_agents/main.py`

## Observe the error

- FileNotFoundError: [Errno 2] No such file or directory: '/code/src/crew_of_agents/config/agents.yaml'

- OK! As we see, the way CrewAI is designed requires us to specify a file called `agents.yaml` that will define how each agent works...

- https://docs.crewai.com/getting-started/Start-a-New-CrewAI-Project-Template-Method/#agentsyaml

- `mkdir -p src/crew_of_agents/config`
- `touch src/crew_of_agents/config/agents.yaml`
```.yaml
george_washington:
  role: >
    American Army General - George Washington
  goal: >
    To lead the American Army to victory in the Revolutionary War.
  backstory: >
    George Washington was born in 1732 in Westmoreland County, Virginia. He was
    the first President of the United States and led the American Army to victory
    in the Revolutionary War. He is known as the "Father of His Country".

thomas_jefferson:
  role: >
    American Founding Father - Thomas Jefferson
  goal: >
    To write the Declaration of Independence and help establish the United States
    as an independent nation.
  backstory: >
    Thomas Jefferson was born in 1743 in Shadwell, Virginia. He was the third
    President of the United States and the principal author of the Declaration of
    Independence. He is known for his role in shaping the early government of the
    United States.
```

AND instead of having a plain ole' default agent in our crew let's configure each agent to use the details outlined in the `agents.yaml` file...

```
@agent
def george_washington(self):
  return Agent(
    config=self.agents_config['george_washington'],
    verbose=True
  )
@agent
def thomas_jefferson(self):
  return Agent(
    config=self.agents_config['thomas_jefferson'],
    verbose=True
  )
```

## Let's try running our crew again

- `python src/crew_of_agents/main.py`

## Observe the error

- FileNotFoundError: [Errno 2] No such file or directory: '/code/src/crew_of_agents/config/tasks.yaml'

- OK! As we see, the way CrewAI is designed requires us to specify a file called `tasks.yaml` that outlines what we want the agents in our crew to do...

- So let's create a file called `tasks.yaml`

- https://docs.crewai.com/getting-started/Start-a-New-CrewAI-Project-Template-Method/#tasksyaml
- `touch src/crew_of_agents/config/tasks.yaml`
```
write_declaration:
    description: >
      Write the Declaration of Independence for the United States.
    expected_output: >
      The Declaration of Independence that will be sent to the British government.
    agent: thomas_jefferson

military_strategy:
    description: >
      Generate a military strategy to defeat the British Army.
    expected_output: >
      A detailed military strategy that will lead to victory in the Revolutionary War.
    agent: george_washington
```

- AND this is how we let our crew know about the tasks we would like it to perform... 
- add tasks to the `crew.py` file

```.py
@task
	def write_declaration(self):
		return Task(
    	config=self.tasks_config["write_declaration"],
    )
@task
	def military_strategy(self):
		return Task(
    	config=self.tasks_config["military_strategy"],
    )
```

## Try running the crew again

- `python src/crew_of_agents/main.py`
- fix issues

## Add environment variables

- `touch .env`
- `echo "OPENAI_API_KEY=" >> .env`
- replace key
- pip install python-dotenv==1.0.1
- add the following code
```main.py
from dotenv import load_dotenv
load_dotenv()
```

## Try running the crew again - THIS SHOULD WORK 🤞

- `python src/crew_of_agents/main.py`

Once a crew is set up tweaking it should be intuitive even for non-coders as for many adjustment you'll only need to edit 
the `agents.yaml` and the `tasks.yaml`

## Tie it all together

Ok! The way we built this crew of agents up from scratch is NOT recommended. But for understanding how CrewAI works it definitely was fun.

Next, we will build another crew using the approach recommended by CrewAI...

https://docs.crewai.com/getting-started/Start-a-New-CrewAI-Project-Template-Method/#creating-a-new-project

BUT! Before we do that...

Let's now track this simple crew using AgentsOps to understand how simple it is...

- Go to https://app.agentops.ai/
- Go to Projects
- + New Project > "Revolutionary War" > `Create Project`
- Copy API key
- add environment variable called AGENTOPS_API_KEY
- `echo "AGENTOPS_API_KEY=" >> .env`
- add the following to `main.py`
```
import os
import agentops

agentops.init(os.getenv("AGENTOPS_API_KEY"))
```
- Observe how VSCode is letting us know the import has an issue
- We want to reuse all the code provided by AgentOps the company for tracking metrics related to our crew
- Let's download the code provided by AgentOps aka let's download the AgentOps package 
- `pip install agentops`

## Run the crew again...

- `python src/crew_of_agents/main.py`
- Observe the additional metrics given to us on the command line
  - Like what the cost to us was of running the crew this session etc.
- And also how the details of this interaction with the agents in our crew was uploaded to AgentOps for reference and review

- As you get deeper into leveraging Agentic workflows you'll need a tool like AgentOps for monitoring how your agents are performing from a variety of angles

The last I'll do is record the exact versions of `crewai` and `agentops` we used in this project so if we ever revisit this in the future we know exactly what was used...

One of the conventional filenames we use for doing this is called requirements.txt...

`touch requirements.txt`
```
agentops==0.3.12
crewai==0.63.6
```

## Inception

And now we can save a copy of our code somewhere else on the internet, for example GitHub...

And then we can delete our Devcontainer and POOF!

It's like nothing ever happened.

# SECOND APPROACH

Now let's build another crew of agents but this time use the approach currently recommended by CrewAI

aka let's use the command line interface...

After we set up our crew of agents using the CrewAI CLI, we'll layer on AgentOps for monitoring and observing all the activity associated with them

https://docs.crewai.com/getting-started/Start-a-New-CrewAI-Project-Template-Method/#creating-a-new-project

## Build the Devcontainer

Ok! We are making this beginner friendly so here we go from scratch (aka an empty folder)...

## SHOW THE BOILERPLATE DIAGRAM

This is the 1st set of files that we will add...

project_root/
├── .devcontainer/
│   └── devcontainer.json
└── Dockerfile.dev

mkdir .devcontainer
touch .devcontainer/devcontainer.json
touch Dockerfile.dev

These files are compatible with Docker...

## Populate `devcontainer.json`

```devcontainer.json
{
  "name": "CrewAI + AgentOps",
  "build": {
    "dockerfile": "../Dockerfile.dev"
  },
  "customizations": {
    "vscode": {
        "extensions": [
            "ms-python.python",
            "ms-python.vscode-pylance",
            "ms-python.black-formatter",
            "ms-python.debugpy",
            "ms-azuretools.vscode-docker",
            "shd101wyy.markdown-preview-enhanced"
        ],
        "settings": {}
    }
  },
  "forwardPorts": [],
  "workspaceMount": "source=${localWorkspaceFolder},target=/code,type=bind,consistency=delegated",
  "workspaceFolder": "/code",
  "runArgs": []
}
```

## Populate `Dockerfile.dev`

```.Dockerfile.dev
FROM python:3.12-slim
RUN apt-get update && apt-get install -y build-essential
WORKDIR /code # set the working directory
ENV PYTHONPATH=/code
```

## Build the Devcontainer

Alrighty, now that we have these files added we can launch our Devcontainer like so...

SHIFT + COMMAND + P -> `Dev Containers: Reopen in Container`

To gloss over the details, we are now in another computer running on our computer. Inception type ish. We can play around with CrewAI in this machine, close it when we're done, and then our base machine will be clean as if nothing ever happened.

Let me know in the comments if you like this approach. I find it helps me stay organized.

Let's run a quick test and make sure we are looking good.

```.py
python --version
touch main.py
echo "print('Hello World')" > main.py
python main.py
```

√

```.py
rm main.py
```

```.py
pwd
```

## Install the crewai CLI

- `pip install crewai`

## Scaffold the crew

- `crewai create crew <project_name>`
- `crewai create crew frequency_music_crew`
- `cd frequency_music_crew`
- `crewai install`

## So this is BY FAR the most confusing part of this walkthrough but bear with me

- Because the crewai CLI generates the project files within a new folder and not in the current folder...
- I will move the generated files up one level...
- I'll move everything up one level with this command: `mv .* * ..`
- All the files within the generate folder are now in the current folder

- We want our current folder to hold a `crewai` project and not a folder within our current folder to hold a `crewai` project
- Once again excuse me if this is confusing

- We also have to update an import: `from src.frequency_music_crew.crew import FrequencyMusicCrewCrew`
- delete the poetry.lock
- reinstall the dependencies: `poetry install`
- And now we should be good √

## Fixing import warnings

- `poetry env info`
- And copy the "path" into the interpreter path setting in VSCode
- SHIFT + COMMAND + P
  - `Python: Select Interpreter`

- This let's VSCode know where to look for 3rd party packages
- And I know it's confusing because we used one tool aka `pip` to install `crewai` onto our machine and we are using another tool aka `poetry` to install packages into our project but AYE! welcome to Python development

## Let's try running the crew...

- `crewai run`
- OK! there are errors related to a missing OPENAI_API_KEY
  - We see the text "error"
  - error code 401
  - OpenAI Incorrect API key
- So by default CrewAI uses OpenAI as the LLM powering the agents in a crew
- So we need to add an API_KEY for authenticating with OpenAI to our project by including it in the .env

## Run again

- `crewai run`

## In case the console output is showing warnings

```
import warnings
warnings.filterwarnings("ignore", message="invalid escape sequence")
```

## CrewAI projects can get quite complicated BUT can can also be very simple

- CrewAI organizes a lot of the configuration for the agents in your crew in the config folder...
- So let's customize our crew by replacing the default "research" and "analyst" agent with the following agents

```
songwriter:
  role: >
    Songwriter
  goal: >
    Write a Billboard #1 Hit song
  backstory: >
    You're an all-time great songwriter with a knack for crafting catchy and commercially successful songs.
    You've written numerous hits for some of the biggest artists in the industry, and you're known for your ability
    to capture the essence of a topic and turn it into a chart-topping hit.

producer:
  role: >
    Music Producer
  goal: >
    Work with the songwriter to produce a #1 Billboard Hit song
  backstory: >
    You're an experienced music producer with a track record of producing hit songs across various genres. Your goal is to 
    output the chord progression, melody, and BPM for the song so that your engineer can program the instruments, the artist can perform the melody, 
    and the mixing engineer can then mix the song.
```

and the following tasks...

```
songwriting:
  description: >
    Write a song about total accountability
  expected_output: >
    Output a song with lyrics and melody.
  agent: songwriter 

producing:
  description: >
    Output the chord progression and melody for the song so that the artist and engineer can record, program, and mix that song
  expected_output: >
    The lyrics, melody, and chord progression for the song clearly and simply outlined
  agent: producer
```

## Update the `crew.py` file

Now that we have our updated config, let's reference it properly in our crew...

- songwriter
- producer
- songwriting
- producting
- song.md

## Explain the updates

So what we are doing here, is creating a hit-making music duo consisting of an acclaimed songwriter & producer and we're tasking them with creating a #1 charting hit

## Track the crew with AgentOps

Before we run our crew and have a million dollar song on our hands, let's track the generated output with AgentOps so we have a copy of our song in the cloud for future reference

- Go to https://app.agentops.ai/
- Go to Projects
- + New Project > "Revolutionary War" > `Create Project`
- Copy API key
- add environment variable called AGENTOPS_API_KEY
- `echo "AGENTOPS_API_KEY=" >> .env`
- add the following to `main.py`
```
import os
import agentops

agentops.init(os.getenv("AGENTOPS_API_KEY"))
```
- Observe how VSCode is letting us know the import has an issue
- We want to reuse all the code provided by AgentOps the company for tracking metrics related to our crew
- Let's download the code provided by AgentOps aka let's download the AgentOps package 

- There are various tools in the Python ecosystem for downloading 3rd party code
- pip is the default tool that comes with Python but over the past few years another tool called `Poetry` has risen in popularity and this is CrewAI recommends us to use
- Poetry does a number of things (that we won't get into) but one of the things that it can do is download 3rd party python code
- So we'll now enter the following COMMAND: `poetry add agentops`

## Run the crew again

- CrewAI allows us to pass in values when we run them for example instead of hard-coding the requirements of our song in our config. We could make some aspects of them dynamic by inserting placeholders

- For example, let's say we wanted to customize the genre...

- We could place { genre } in select places of our crew configuration and replace them at runtime by passing them as input values like so...

```
inputs = {
  'genre': 'Country'
}
FrequencyMusicCrewCrew().crew().kickoff(inputs=inputs)
```

But we are just keeping it simple to get the basics down. And you can explore more of the advanced features offered by CrewAI outside of this video...

```
FrequencyMusicCrewCrew().crew().kickoff()
```

Let's run the crew again: `crewai run`

# SUPERSAIYAN

Alright now we have a rough outline of song, taking a quick look this leaves a lot of room for interpretation but let's produce it and see what it sounds like...

